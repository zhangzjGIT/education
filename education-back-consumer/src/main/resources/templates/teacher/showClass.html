<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>课程审核</title>
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">

</head>
<body>

<table class="layui-hide" id="classId" lay-filter="test"></table>


<div class="layui-tab-item">
    <div id="pageDemo"></div>
</div>

<script src="/layui/layui.js"></script>
<script src="../layui/lay/modules/laypage.js"></script>
<script>

    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider'], function(){
        var laydate = layui.laydate //日期
            ,laypage = layui.laypage //分页
            ,layer = layui.layer //弹层
            ,table = layui.table //表格
            ,carousel = layui.carousel //轮播
            ,upload = layui.upload //上传
            ,element = layui.element //元素操作
            ,slider = layui.slider //滑块

        //第一个实例
        table.render({
            elem: '#classId'
            ,height: 500
            ,url: '/user/queryCourse' //数据接口
            ,method:'post'
            ,page: true //开启分页
            // ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            ,totalRow: true //开启合计行

            ,cols: [
                [ //表头
                    {field: 'couId', title: 'ID',  sort: true, fixed: 'left'}
                    ,{field:'couTitle', title: '课程标题'}
                    ,{field:'couType', title: '课程类型',templet:'<div>{{  showType(d.couType) }}</div>'}
                    ,{field:'couClass',  title: '课程分类',templet:'<div>{{  showClass(d.couClass) }}</div>'}
                    ,{field:'couPrice',  title: '课程价格',sort:true}
                    ,{field:'priImg', title: '课程封面', templet:'<div><img width="100px" height="100px" src="{{ d.priImg}}"></div>'}
                    ,{field:'infoName', title: '视频名称'}
                    ,{field:'couState', title: '课程说明'}
                    ,{field:'teacherName',  title: '授课讲师'}
                    ,{field:'allCount',  title: '总数量'}
                    ,{field:'stuCount',  title: '学生数'}
                    ,{field :'status'  , title :'审批状态' , minWidth : 100, templet : '#switchNullTpl', unresize : true}

                ]
            ],

    });

//分页
        laypage.render({
            elem:'pageDemo'
            ,count:'count'
            ,curr:'page'
            ,limit:'limit'
            ,layout: ['prev', 'page', 'next', 'skip','count','limit']
            ,jump:function (obj,first) {
                if(!first){
                    curnum = obj.curr;
                    limitcount = obj.limit;
                    //console.log("curnum"+curnum);
                    //console.log("limitcount"+limitcount);
                    //layer.msg(curnum+"-"+limitcount);
                    productsearch(productGroupId,curnum,limitcount);
                }
            }
        })


    });


    //审核按钮
    layui.use(['layer','form'], function () {
        var $ = layui.jquery
            , upload = layui.upload
            , form = layui.form
            , layer = layui.layer;

        form.on('switch(switchTest)', function(obj){
            // 获取当前控件
            var status_id = obj.value;
            //  alert("状态值："+status_id);
            var data = $(obj.elem);
            //遍历父级tr，取第一个，然后查找第二个td，取值
            var id = data.parents('tr').first().find('td').eq(0).text();
            // 获取当前所在行的索引
            //  alert("当前Id值："+id);
            $.ajax({
                url: "/user/updClassStatus",
                type: "post",
                dataType: "JSON",
                data: {status: status_id, couId: id},
                success: function () {

                    layer.msg("修改成功！！！");
                    location.reload();
                },
                error:function(){
                    layer.msg("修改失败！！！");
                }
            });
        });
    });

</script>
<script>

    function showType(type){
        if(type == 1 ){
            return "点播";
        }else{
            return "直播";
        }
    }
    function showClass(cou){
        if(cou == 1 ){
            return "IT▪互联网";
        }else if(cou == 2 ){
            return "设计▪创作";
        }
        else if(cou == 3 ){
            return "语言▪留学";
        }
        else if(cou == 4 ){
            return "职业▪考证";
        }
        else if(cou == 5 ){
            return "升学▪考研";
        }
        else if(cou == 6){
            return "兴趣▪生活";
        }
        else{
            return "其他";
        }
    };
</script>

<script id="switchNullTpl" type="text/html">
    <input type="checkbox" name="status"  value="{{d.status}}" lay-skin="switch" lay-text="√|×" lay-filter="switchTest" {{ d.status == 1 ? 'checked' : '' }}>
</script>



</body>
</html>